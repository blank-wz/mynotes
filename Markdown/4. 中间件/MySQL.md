# 数据库1 - MySQL



MySQL 常用数据类型



字符串的基本使用

char(size) 固定长度字符串, 最大255字符

varchar(size)   可变长度字符串 最大65535字节 (utf8 编码最大21844字符,1-3个字节用于记录大小) 

char(4) 和 varchar(4)  4表示的是字符,而不是字节, 不区分字符是汉字还是字母

如果varchar 不够用,可以考虑使用 text, mediumtext 或者 longtext





## 事务的4个特性 ACID

原子性（Atomicity，或称不可分割性）、一致性（Consistency）、隔离性（Isolation，又称独立性）、持久性（Durability）

1. **原子性**：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中如果发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
2. **一致性**：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。
3. **隔离性**：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。
4. **持久性**：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。



## 事务的隔离级别

1. 读未提交（Read uncommitted） 安全性最差,可能发生并发数据问题,性能最好
2. 读提交（read committed）   Oracle默认的隔离级别
3. 可重复读（repeatable read）MySQL默认的隔离级别,安全性较好,性能一般
4. 串行化（Serializable）    表级锁，读写都加锁，效率低下,安全性高,不能并发



## 数据库优化

### 1) 数据库服务器内核优化

### 2) my.cnf 配置, 一般搭配压力测试进行调试

### 3) SQL 语句优化

1. 查询SQL尽量不要使用select *，而是具体字段
2. where限定查询的数据 (需要什么数据，就去查什么数据，避免返回不必要的数据)
3. 避免在where子句中使用or来连接条件 (使用or可能会使索引失效，从而全表扫描)
4. 提高group by语句的效率 (先过滤，后分组)
5. 使用varchar代替char
6. 尽量使用数值替代字符串类型
7. 使用 explain 分析你 SQL 执行计划
8. 优化 like 语句
9. 索引不宜太多，一般5个以内
10. 索引不适合建在有大量重复数据的字段上 (Mysql 查询优化器推算发现不走索引的成本更低，很可能就放弃索引了)
11. 避免对索引字段进行计算、避免索引在字段上使用**not、<>、！=、**避免在索引上使用**IS NULL和NOT NULL**、**避免在索引列上出现数据类型转换、避免索引字段使用函数、避免建立索引的列出现空值**
12. 去重 distinct 过滤字段要少
13. where 中使用默认值代替 null
14. 批量插入性能提升 (默认新增SQL有事务控制，导致每条都需要事务开启和事务提交；而批量处理是一次事务开启和提交。自然速度飞升)
15. 批量删除优化 (避免同时修改或删除过多数据，因为会造成cpu利用率过高，次性删除太多数据，可能造成锁表，会有 lock wait timeout exceed 的错误，所以建议分批操作)
16. 伪删除设计
17. 不要有超过5个以上的表连接
18. inner join 、left join、right join，优先使用inner join

